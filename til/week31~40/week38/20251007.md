# 시간

- 13:00 ~ 18:00 : 추석 가족들과 시간
- 20:00 ~ 24:00 : 대규모 트래픽

# 간략 회고

### 대규모 트래픽

좋아요 관련 대규모 트래픽에 대해서 학습하였다.

게시글 마다 보통 좋아요가 하나씩 딸려있다. 그러면 좋아요 테이블을 따로 만들고 조인 연산으로 그 좋아요를 모두 count하면 될 것인가?

아니다. 게시글 마다 좋아요가 엄청 많고 그것을 조인 연산으로 count 연산으로 세면서 가져온다면 자주 있는 Get 요청에 대해서

부하가 엄청 심할 것이다.

그러면 게시글 테이블에 반정규화로 count를 필드로 선언하여 바로바로 가져오는 방안을 생각할 수 있다.

그러면 끝인가? 아니다. 반정규화를 했기 떄문에 원자적 처리를 신경 써주어야 한다. 즉, 좋아요 테이블과 게시글 테이블의 좋아요가

원자성을 이루도록 트랜잭션을 묶어 SQL 문을 작성해야 안전하다.

그러면 정말 끝인가..? 보통의 트래픽이라면 여기서 끝날 수 가 있다. 그런데 대규모 트래픽을 생각해보자.

게시글에 좋아요 수를 늘리려면 where 문으로 해당 게시글을 찾고 좋아요 수를 늘릴 것이다. 그러면 해당 레코드에 lock이 걸린다.

좋아요 수에 대한 쓰기 연산은 게시글에 비해서 엄청나게 많다. 게시글과 좋아요는 라이프 사이클이 아예 다르다. 게시글 수정은 가끔있고

좋아요는 엄청 많은 쓰기 트래픽이 일어난다.

엄청 많은 좋아요 떄문에 게시글 수정이나 삭제 등이 먹히지 않을 수도 있는 것이다. 이 둘은 분리할 필요가 있다는 생각이 든다.

따라서 좋아요 부분은 좋아요 테이블을 따로 분리한다. 이 강의는 MSA 구축이 기본 전제이므로 좋아요 서비스가 따로 있따.

이 좋아요 서비스에 좋아요 테이블을 구축하고 게시글과 좋아요를 분리한다.

그러면 게시글 수정, 등록과 좋아요 등록에 대해서 분리가 되어 따로 관리할 수 있다.

만약 좋아요에 쓰기 트래픽이 엄청 많다면 그것을 게시글이 알 필요는 없다. 좋아요 서비스가 책임져야하는 것이다.

게시글은 그것을 몰라도 좋아요 트래픽이 몰리면 좋아요 서비스 측에서 레디스를 활용하든 배치를 활용하든, 그쪽이 해야하는 일이다.

이렇게 게시글은 좋아요 떄문에 에러나 나거나 하는 일이 감소되었다.